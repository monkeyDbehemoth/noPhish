<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>noPhish Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        body { background: #0a0a0a; color: #fff; }
        .sidebar { min-height: 100vh; background: #111; border-right: 1px solid #333; }
        .sidebar a { color: #888; text-decoration: none; padding: 12px 20px; display: block; border-radius: 0; }
        .sidebar a:hover, .sidebar a.active { background: #1a1a1a; color: #00ff88; }
        .stat-card { border: none; border-radius: 10px; background: #111; border: 1px solid #333; }
        .stat-card.phishing { border-color: #ff4444; }
        .stat-card.clean { border-color: #00ff88; }
        .stat-card.total { border-color: #4488ff; }
        .table-card { border: none; border-radius: 10px; background: #111; border: 1px solid #333; }
        .badge-phishing { background: #ff4444; }
        .badge-clean { background: #00ff88; color: #000; }
        .scanner-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff88, transparent);
            animation: scan 2s linear infinite;
            display: none;
        }
        .scanning .scanner-line { display: block; }
        .live-indicator {
            width: 10px;
            height: 10px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 1s infinite;
            display: inline-block;
        }
        .activity-item {
            border-left: 2px solid #333;
            padding-left: 15px;
            margin-left: 10px;
            position: relative;
        }
        .activity-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0;
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }
        .activity-item.phishing::before { background: #ff4444; }
        .activity-item.clean::before { background: #00ff88; }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 sidebar p-0">
                <div class="p-3 border-bottom border-secondary">
                    <h5><i class="bi bi-shield-exclamation" style="color: #00ff88;"></i> noPhish</h5>
                    <small style="color: #666;">Phishing Detection</small>
                </div>
                <nav>
                    <a href="#" onclick="showPage('dashboard')" class="active" id="nav-dashboard">
                        <i class="bi bi-house-door"></i> Dashboard
                    </a>
                    <a href="#" onclick="showPage('emails')" id="nav-emails">
                        <i class="bi bi-envelope"></i> All Emails
                    </a>
                    <a href="#" onclick="showPage('live')" id="nav-live">
                        <i class="bi bi-activity"></i> Live Monitor
                    </a>
                </nav>
            </div>
            <div class="col-md-10 p-4" id="content">
            </div>
        </div>
    </div>

    <script>
        let emails = JSON.parse(localStorage.getItem('nophish_emails') || '[]');
        let activityLog = JSON.parse(localStorage.getItem('nophish_activity') || '[]');

        function saveEmails() {
            localStorage.setItem('nophish_emails', JSON.stringify(emails));
            updateDashboard();
        }

        function addActivity(type, sender, subject, score) {
            const activity = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                type: type,
                sender: sender,
                subject: subject,
                score: score
            };
            activityLog.unshift(activity);
            activityLog = activityLog.slice(0, 50);
            localStorage.setItem('nophish_activity', JSON.stringify(activityLog));
        }

        function simulateLiveMonitoring() {
            const scanStatus = document.getElementById('scan-status');
            if (scanStatus) {
                scanStatus.innerHTML = '<span class="live-indicator"></span> Scanning inbox...';
            }
            
            setTimeout(() => {
                if (emails.length > 0 && activityLog.length > 0) {
                    const latest = activityLog[0];
                    if (scanStatus) {
                        scanStatus.innerHTML = `<span style="color: ${latest.type === 'phishing' ? '#ff4444' : '#00ff88'}">
                            <i class="bi bi-${latest.type === 'phishing' ? 'exclamation-triangle' : 'check-circle'}"></i>
                            Last scan: ${latest.type.toUpperCase()} - Score: ${latest.score}
                        </span>`;
                    }
                } else {
                    if (scanStatus) {
                        scanStatus.innerHTML = '<span style="color: #666;">Waiting for emails...</span>';
                    }
                }
            }, 2000);
        }

        function addDemoData() {
            if (emails.length === 0) {
                emails = [
                    {
                        id: 1,
                        timestamp: new Date().toISOString(),
                        sender: 'security@paypal-fake.com',
                        subject: 'URGENT: Your account has been compromised!',
                        is_phishing: true,
                        total_score: 8,
                        url_score: 3,
                        html_score: 3,
                        ml_score: 2,
                        url_reasons: ['Suspicious URL: paypal-fake.com'],
                        html_reasons: ['Password field detected'],
                        ml_reasons: ['urgent keyword detected']
                    }
                ];
                addActivity('phishing', 'security@paypal-fake.com', 'URGENT: Your account has been compromised!', 8);
                saveEmails();
            }
        }

        function updateDashboard() {
            const total = emails.length;
            const phishing = emails.filter(e => e.is_phishing).length;
            const clean = total - phishing;
            const rate = total > 0 ? Math.round((phishing / total) * 100) : 0;

            document.getElementById('content').innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-speedometer2"></i> Dashboard 
                        <span id="scan-status" style="font-size: 14px; color: #666;"></span>
                    </h2>
                    <div>
                        <span class="live-indicator"></span>
                        <span style="color: #00ff88; margin-left: 8px;">LIVE</span>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card stat-card total p-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div><h6 class="mb-1" style="color: #4488ff;">Total Emails</h6><h2 class="mb-0">${total}</h2></div>
                                <i class="bi bi-envelope-fill" style="font-size: 3rem; opacity: 0.3; color: #4488ff;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card phishing p-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div><h6 class="mb-1" style="color: #ff4444;">Phishing Detected</h6><h2 class="mb-0">${phishing}</h2></div>
                                <i class="bi bi-exclamation-triangle-fill" style="font-size: 3rem; opacity: 0.3; color: #ff4444;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card clean p-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <div><h6 class="mb-1" style="color: #00ff88;">Clean Emails</h6><h2 class="mb-0">${clean}</h2></div>
                                <i class="bi bi-check-circle-fill" style="font-size: 3rem; opacity: 0.3; color: #00ff88;"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card table-card">
                            <div class="card-header bg-dark border-secondary"><h5 class="mb-0"><i class="bi bi-pie-chart"></i> Detection Rate</h5></div>
                            <div class="card-body text-center">
                                <div class="display-4" style="color: ${rate > 50 ? '#ff4444' : '#00ff88'}">${rate}%</div>
                                <p class="text-muted">Phishing detection rate</p>
                                <div class="progress bg-dark" style="height: 25px;">
                                    <div class="progress-bar bg-danger" style="width: ${rate}%"></div>
                                    <div class="progress-bar bg-success" style="width: ${100-rate}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card table-card">
                            <div class="card-header bg-dark border-secondary">
                                <h5 class="mb-0"><i class="bi bi-lightning"></i> Recent Activity</h5>
                            </div>
                            <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                                ${activityLog.slice(0, 5).map(a => `
                                    <div class="activity-item ${a.type} mb-2">
                                        <small style="color: #666;">${new Date(a.timestamp).toLocaleTimeString()}</small><br>
                                        <strong style="color: ${a.type === 'phishing' ? '#ff4444' : '#00ff88'}">
                                            <i class="bi bi-${a.type === 'phishing' ? 'exclamation-triangle' : 'check-circle'}"></i>
                                            ${a.type.toUpperCase()}
                                        </strong>
                                        <br><span style="color: #888;">${a.subject.substring(0, 40)}...</span>
                                    </div>
                                `).join('')}
                                ${activityLog.length === 0 ? '<p class="text-muted">No activity yet</p>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            simulateLiveMonitoring();
        }

        function showLiveMonitor() {
            document.getElementById('content').innerHTML = `
                <div class="text-center">
                    <h2><i class="bi bi-radar" style="color: #00ff88;"></i> Live Email Monitoring</h2>
                    <p class="text-muted">Waiting for incoming emails from Gmail...</p>
                </div>
                <div class="card table-card scanning" style="position: relative; overflow: hidden;">
                    <div class="scanner-line"></div>
                    <div class="card-body text-center py-5">
                        <div style="font-size: 80px;">
                            <i class="bi bi-envelope-open" style="color: #333;"></i>
                        </div>
                        <h4 class="mt-3" id="live-status" style="color: #00ff88;">Connecting to Gmail...</h4>
                        <p class="text-muted">The system checks your Gmail every 5 minutes</p>
                        <div class="mt-4">
                            <button class="btn btn-outline-primary" onclick="refreshDashboard()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh Now
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="card table-card">
                            <div class="card-header bg-dark border-secondary">
                                <h5 class="mb-0">Activity Log</h5>
                            </div>
                            <div class="card-body">
                                ${activityLog.map(a => `
                                    <div class="activity-item ${a.type} mb-3">
                                        <div class="d-flex justify-content-between">
                                            <strong style="color: ${a.type === 'phishing' ? '#ff4444' : '#00ff88'}">
                                                <i class="bi bi-${a.type === 'phishing' ? 'exclamation-triangle' : 'check-circle'}"></i>
                                                ${a.type.toUpperCase()}
                                            </strong>
                                            <small style="color: #666;">${new Date(a.timestamp).toLocaleString()}</small>
                                        </div>
                                        <div>From: ${a.sender}</div>
                                        <div>Subject: ${a.subject}</div>
                                        <div>Score: <span class="badge ${a.score >= 3 ? 'bg-danger' : 'bg-success'}">${a.score}/10</span></div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const status = document.getElementById('live-status');
                if (status && emails.length > 0) {
                    status.innerHTML = '<i class="bi bi-check-circle"></i> Monitoring Active';
                    status.style.color = '#00ff88';
                }
            }, 1500);
        }

        function showEmails() {
            document.getElementById('content').innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="bi bi-envelope"></i> Email Logs</h2>
                    <div>
                        <button class="btn btn-outline-danger" onclick="clearData()"><i class="bi bi-trash"></i> Clear All</button>
                        <button class="btn btn-outline-primary" onclick="refreshDashboard()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                    </div>
                </div>
                <div class="card table-card">
                    <div class="card-body p-0">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr><th>Time</th><th>Status</th><th>Sender</th><th>Subject</th><th>Score</th></tr>
                            </thead>
                            <tbody>
                                ${emails.length === 0 ? '<tr><td colspan="5" class="text-center py-4">No emails yet</td></tr>' : ''}
                                ${emails.map(e => `
                                    <tr>
                                        <td>${new Date(e.timestamp).toLocaleString()}</td>
                                        <td><span class="badge ${e.is_phishing ? 'badge-phishing' : 'badge-clean'}">${e.is_phishing ? 'Phishing' : 'Clean'}</span></td>
                                        <td>${(e.sender || '').substring(0, 30)}</td>
                                        <td>${(e.subject || '').substring(0, 40)}</td>
                                        <td><span class="badge bg-${e.is_phishing ? 'danger' : 'secondary'}">${e.total_score}/10</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function clearData() {
            if (confirm('Clear all email data?')) {
                emails = [];
                activityLog = [];
                saveEmails();
            }
        }

        function refreshDashboard() {
            location.reload();
        }

        function showPage(page) {
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            document.getElementById('nav-' + page).classList.add('active');
            if (page === 'dashboard') updateDashboard();
            else if (page === 'emails') showEmails();
            else if (page === 'live') showLiveMonitor();
        }

        addDemoData();
        updateDashboard();
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            updateDashboard();
        }, 30000);
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
